<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>智慧公厕 - 保洁打卡</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com/3.4.1"></script>
    <!-- Google Fonts: Roboto for general text, Noto Sans SC for Chinese -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Tabler Icons CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@tabler/icons-webfont@latest/tabler-icons.min.css">
    <style>
        body {
            font-family: 'Roboto', 'Noto Sans SC', sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: #000000; /* Black letterbox */
            margin: 0;
            overflow: hidden; /* Prevent body scroll */
        }
        #app-wrapper {
            width: 100%;
            max-width: 400px; /* Typical mobile width, adjust as needed */
            height: 100vh;
            max-height: 800px; /* 9:18 ratio roughly, adjust as needed */
            box-shadow: 0 0 30px rgba(255, 255, 255, 0.1);
            position: relative; /* For watermark positioning */
            background-color: #f0f2f5; /* Fallback app background */
        }
        /* Ensure app takes full height of its wrapper */
        .app-container {
            width: 100%;
            height: 100%;
            overflow-y: auto; /* Allow scrolling within the app */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }
        /* Custom scrollbar (optional, for aesthetics) */
        .app-container::-webkit-scrollbar {
            width: 4px;
        }
        .app-container::-webkit-scrollbar-thumb {
            background-color: rgba(0,0,0,0.2);
            border-radius: 2px;
        }
        .app-container::-webkit-scrollbar-track {
            background-color: rgba(0,0,0,0.05);
        }
        .watermark {
            position: absolute;
            bottom: 10px;
            opacity: 0.3;
            font-size: 10px;
            color: #FFFFFF;
            pointer-events: none; /* Allow clicks to pass through */
            z-index: 9999;
        }
        .watermark-left { left: 10px; }
        .watermark-right { right: 10px; }

        /* Helper for icon sizing */
        .icon-sm { font-size: 1.25rem; /* 20px */ }
        .icon-md { font-size: 1.5rem; /* 24px */ }
        .icon-lg { font-size: 2rem; /* 32px */ }

        /* Star rating styling */
        .star-rating { display: flex; align-items: center; }
        .star-rating .ti-star-filled { color: #FFC107; }
        .star-rating .ti-star { color: #E0E0E0; }

        /* Custom card with a slight tab/folder shape at the top left */
        .info-card {
            background-color: white;
            border-radius: 16px; /* Main border radius */
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.07), 0 4px 10px -6px rgba(0, 0, 0, 0.07);
            position: relative;
            padding: 20px;
            overflow: hidden; /* Important for pseudo-elements */
        }
        .info-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 80px;
            height: 30px;
            background: linear-gradient(135deg, #60A5FA 0%, #3B82F6 100%); /* Blue gradient, can be theme color */
            border-radius: 0 0 16px 0; /* Creates the "tab" effect */
            clip-path: polygon(0 0, 100% 0, 100% 100%, 15% 100%, 0 70%); /* More complex shape */
        }
        .info-card-title {
            font-size: 1.125rem; /* text-lg */
            font-weight: 600; /* semibold */
            color: #1F2937; /* gray-800 */
            margin-bottom: 1rem;
            position: relative;
            padding-left: 10px; /* Space for potential icon */
        }
        .info-card-title i {
            margin-right: 8px;
            color: #3B82F6; /* Blue-500 */
        }

        /* Blur background for header */
        .header-blur {
            background-color: rgba(255, 255, 255, 0.7); /* Semi-transparent white */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }

        /* Subtle gradient text */
        .gradient-text {
            background: linear-gradient(to right, #3B82F6, #1E40AF);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-fill-color: transparent;
        }

    </style>
</head>
<body>
    <div id="app-wrapper">
        <!-- Watermarks -->
        <div class="watermark watermark-left">
            Gemini AI &nbsp; <span id="watermark-date-left"></span>
        </div>
        <div class="watermark watermark-right">
            UUID: <span id="watermark-uuid"></span>
        </div>

        <div id="app" class="app-container bg-gradient-to-br from-slate-100 via-gray-100 to-sky-100">
            <!-- Vue App will be mounted here -->
            <div class="min-h-full flex flex-col">

                <!-- Header -->
                <header class="p-5 sticky top-0 z-20 header-blur shadow-md">
                    <div class="flex items-center justify-between">
                        <img src="https://assets.codepen.io/7804097/intelligent-toilet-logo.png" alt="Logo" class="h-8 w-auto">
                        <h1 class="text-xl font-semibold text-gray-700 tracking-tight">保洁员作业终端</h1>
                        <i class="ti ti-user-circle icon-md text-blue-600"></i>
                    </div>
                </header>

                <main class="flex-grow p-5 space-y-6 pb-20"> <!-- Added padding-bottom for potential fixed bottom elements -->
                    <!-- Toilet Info & Cleaner -->
                    <section class="bg-white p-6 rounded-xl shadow-lg relative overflow-hidden">
                         <div class="absolute -top-10 -right-10 w-32 h-32 bg-blue-500 opacity-10 rounded-full"></div>
                         <div class="absolute top-5 left-5 w-20 h-20 bg-sky-400 opacity-15 rounded-full blur-sm"></div>
                        <div class="relative z-10">
                            <div class="flex items-center mb-3">
                                <i class="ti ti-map-pin-filled icon-md text-blue-600 mr-3"></i>
                                <h2 id="toiletName" class="text-2xl font-bold text-gray-800">春熙路南口公共卫生间</h2>
                            </div>
                            <p class="text-sm text-gray-500 mb-1">
                                <i class="ti ti-user-scan mr-1 align-middle"></i>
                                当前保洁员: <strong id="cleanerName" class="text-gray-700">李明华</strong> (工号: 10086)
                            </p>
                            <p class="text-xs text-gray-400">
                                <i class="ti ti-clock mr-1 align-middle"></i>
                                上次打卡: <span id="lastPunchTime">2023-10-27 08:15</span>
                            </p>
                        </div>
                    </section>

                    <!-- Punch Card Button -->
                    <section class="my-8 text-center">
                        <button id="punchButton" @click="handlePunch"
                                class="w-full max-w-xs mx-auto bg-gradient-to-br from-blue-500 to-indigo-600 hover:from-blue-600 hover:to-indigo-700 text-white font-semibold py-5 px-8 rounded-full shadow-xl hover:shadow-2xl transform hover:scale-105 transition-all duration-300 ease-in-out focus:outline-none focus:ring-4 focus:ring-blue-300">
                            <div class="flex items-center justify-center">
                                <i class="ti ti-fingerprint icon-lg mr-3"></i>
                                <span class="text-xl tracking-wide" id="punchButtonText">上班打卡</span>
                            </div>
                            <p class="text-xs opacity-80 mt-1" id="currentTimeLocation">正在获取时间与位置...</p>
                        </button>
                    </section>

                    <!-- Toilet Details Card -->
                    <section class="info-card">
                        <h3 class="info-card-title"><i class="ti ti-info-circle"></i>公厕详情</h3>
                        <div class="space-y-3 text-sm text-gray-700">
                            <div class="flex items-start">
                                <i class="ti ti-clock-hour-4 text-blue-500 mr-3 mt-1 flex-shrink-0"></i>
                                <div>
                                    <span class="font-medium text-gray-600">开放时间：</span>
                                    <span id="openTime">全天 24 小时</span>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <i class="ti ti-building-community text-blue-500 mr-3 mt-1 flex-shrink-0"></i>
                                <div>
                                    <span class="font-medium text-gray-600">养护单位：</span>
                                    <span id="maintenanceUnit">成都智慧城市环卫集团</span>
                                </div>
                            </div>
                            <div class="flex items-start">
                                <i class="ti ti-phone-call text-blue-500 mr-3 mt-1 flex-shrink-0"></i>
                                <div>
                                    <span class="font-medium text-gray-600">联系电话：</span>
                                    <a href="tel:028-12345678" id="contactPhone" class="text-blue-600 hover:underline">028-12345678</a>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- User Ratings Card -->
                    <section class="info-card">
                         <h3 class="info-card-title"><i class="ti ti-mood-smile-beam"></i>用户评价概览</h3>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between">
                                <span class="text-sm text-gray-700 font-medium">整体满意度</span>
                                <div class="star-rating">
                                    <i class="ti ti-star-filled"></i><i class="ti ti-star-filled"></i><i class="ti ti-star-filled"></i><i class="ti ti-star-filled"></i><i class="ti ti-star-half-filled text-yellow-400"></i>
                                    <span class="ml-2 text-sm font-semibold text-gray-700">4.7</span>
                                </div>
                            </div>
                            <div class="border-t border-gray-200 pt-3 space-y-2">
                                <div class="flex items-center justify-between text-xs text-gray-600">
                                    <span><i class="ti ti-sparkles text-green-500 mr-1"></i>清洁度</span>
                                    <div class="star-rating">
                                        <i class="ti ti-star-filled"></i><i class="ti ti-star-filled"></i><i class="ti ti-star-filled"></i><i class="ti ti-star-filled"></i><i class="ti ti-star-filled"></i>
                                        <span class="ml-1 text-gray-600">(4.9)</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between text-xs text-gray-600">
                                    <span><i class="ti ti-settings-cog text-orange-500 mr-1"></i>设施完好度</span>
                                    <div class="star-rating">
                                        <i class="ti ti-star-filled"></i><i class="ti ti-star-filled"></i><i class="ti ti-star-filled"></i><i class="ti ti-star-filled"></i><i class="ti ti-star"></i>
                                        <span class="ml-1 text-gray-600">(4.2)</span>
                                    </div>
                                </div>
                                <div class="flex items-center justify-between text-xs text-gray-600">
                                    <span><i class="ti ti-wind text-sky-500 mr-1"></i>异味控制</span>
                                    <div class="star-rating">
                                        <i class="ti ti-star-filled"></i><i class="ti ti-star-filled"></i><i class="ti ti-star-filled"></i><i class="ti ti-star-filled"></i><i class="ti ti-star-half-filled text-yellow-400"></i>
                                        <span class="ml-1 text-gray-600">(4.6)</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </section>

                    <!-- Suggestions Card -->
                    <section class="info-card">
                        <h3 class="info-card-title"><i class="ti ti-message-circle-2"></i>最新意见与建议</h3>
                        <div id="suggestionsList" class="space-y-4">
                            <!-- Suggestion Item 1 -->
                            <div class="p-3 bg-slate-50 rounded-lg border border-slate-200 hover:shadow-md transition-shadow">
                                <div class="flex justify-between items-start mb-1">
                                    <p class="text-sm text-gray-700 leading-relaxed">建议在洗手台旁增设一个挂钩，方便访客挂置随身小包。目前不太方便。</p>
                                    <img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8Mnx8dXNlciUyMHByb2ZpbGV8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=50&q=60" alt="User Avatar" class="w-8 h-8 rounded-full ml-2 object-cover">
                                </div>
                                <p class="text-xs text-gray-400"><i class="ti ti-calendar-event mr-1"></i>2023年10月26日 14:30</p>
                            </div>
                            <!-- Suggestion Item 2 -->
                            <div class="p-3 bg-slate-50 rounded-lg border border-slate-200 hover:shadow-md transition-shadow">
                                <div class="flex justify-between items-start mb-1">
                                    <p class="text-sm text-gray-700 leading-relaxed">第三个隔间的门锁有些松动，希望能尽快维修，谢谢！</p>
                                     <img src="https://images.unsplash.com/photo-1500648767791-00dcc994a43e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxzZWFyY2h8NHx8dXNlciUyMHByb2ZpbGV8ZW58MHx8MHx8fDA%3D&auto=format&fit=crop&w=50&q=60" alt="User Avatar" class="w-8 h-8 rounded-full ml-2 object-cover">
                                </div>
                                <p class="text-xs text-gray-400"><i class="ti ti-calendar-event mr-1"></i>2023年10月25日 09:12</p>
                            </div>
                            <!-- Empty State (Example) -->
                            <!--
                            <div id="emptySuggestions" class="text-center py-8">
                                <i class="ti ti-mail-off icon-lg text-gray-400 mb-3"></i>
                                <p class="text-gray-500">暂无最新的意见与建议</p>
                                <p class="text-xs text-gray-400 mt-1">用户的反馈将帮助我们做得更好</p>
                            </div>
                            -->
                        </div>
                        <div class="mt-4 text-center" v-if="hasMoreSuggestions">
                             <button class="text-sm text-blue-600 hover:text-blue-700 font-medium py-2 px-4 rounded-lg hover:bg-blue-50 transition-colors">
                                查看全部建议 <i class="ti ti-arrow-right ml-1"></i>
                            </button>
                        </div>
                    </section>

                </main>
            </div>
        </div>
    </div>

    <script>
        // Basic Vue 3 App (CDN version)
        const { createApp, ref, onMounted } = Vue;

        createApp({
            setup() {
                const toiletName = ref("春熙路南口公共卫生间"); // Example data
                const cleanerName = ref("李明华");
                const lastPunchTime = ref("2024-07-15 08:15");
                const openTime = ref("全天 24 小时");
                const maintenanceUnit = ref("成都智慧城市环卫集团");
                const contactPhone = ref("028-12345678");
                const punchButtonText = ref("上班打卡");
                const currentTimeLocation = ref("正在获取时间与位置...");
                const isPunchedIn = ref(false); // Tracks punch-in state
                const hasMoreSuggestions = ref(true); // Example for "view more"

                const updateTimeAndLocation = () => {
                    const now = new Date();
                    const timeString = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit' });
                    // Simulate location fetching
                    if (navigator.geolocation) {
                        navigator.geolocation.getCurrentPosition(
                            (position) => {
                                const lat = position.coords.latitude.toFixed(4);
                                const lon = position.coords.longitude.toFixed(4);
                                currentTimeLocation.value = `${timeString} @ ${lat}, ${lon}`;
                            },
                            () => {
                                currentTimeLocation.value = `${timeString} @ 位置获取失败`;
                            },
                            { timeout: 5000, enableHighAccuracy: true }
                        );
                    } else {
                        currentTimeLocation.value = `${timeString} @ 浏览器不支持定位`;
                    }
                };

                const handlePunch = () => {
                    const punchButton = document.getElementById('punchButton');
                    const punchButtonTextEl = document.getElementById('punchButtonText');
                    
                    punchButton.disabled = true;
                    punchButtonTextEl.textContent = "打卡中...";
                    punchButton.classList.add('opacity-75', 'cursor-not-allowed');


                    // Simulate API call
                    setTimeout(() => {
                        isPunchedIn.value = !isPunchedIn.value;
                        const now = new Date();
                        const打卡时间 = now.toLocaleString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit', hour: '2-digit', minute: '2-digit' });

                        if (isPunchedIn.value) {
                            punchButtonText.value = "下班打卡";
                            lastPunchTime.value = `已上班: ${打卡时间}`;
                            // Show success message (can be a toast notification in a real app)
                            alert(`上班打卡成功！\n时间: ${打卡时间}\n地点: ${currentTimeLocation.value.split('@')[1]?.trim() || '未知地点'}`);
                        } else {
                            punchButtonText.value = "上班打卡";
                            lastPunchTime.value = `已下班: ${打卡时间}`;
                            alert(`下班打卡成功！\n时间: ${打卡时间}\n地点: ${currentTimeLocation.value.split('@')[1]?.trim() || '未知地点'}`);
                        }
                        
                        punchButtonTextEl.textContent = punchButtonText.value;
                        punchButton.disabled = false;
                        punchButton.classList.remove('opacity-75', 'cursor-not-allowed');
                        updateTimeAndLocation(); // Refresh time/location string
                    }, 1500);
                };

                onMounted(() => {
                    updateTimeAndLocation();
                    setInterval(updateTimeAndLocation, 30000); // Update time every 30 seconds

                    // Set watermark date and UUID
                    const today = new Date();
                    document.getElementById('watermark-date-left').textContent = today.toISOString().split('T')[0];
                    // Generate 8-digit hex UUID
                    let uuid = '';
                    for (let i = 0; i < 8; i++) {
                        uuid += Math.floor(Math.random() * 16).toString(16);
                    }
                    document.getElementById('watermark-uuid').textContent = uuid;

                    // Populate dynamic elements if they exist (Vue handles this via refs, but good for non-Vue parts)
                    document.getElementById('toiletName').textContent = toiletName.value;
                    document.getElementById('cleanerName').textContent = cleanerName.value;
                    document.getElementById('lastPunchTime').textContent = lastPunchTime.value;
                    document.getElementById('openTime').textContent = openTime.value;
                    document.getElementById('maintenanceUnit').textContent = maintenanceUnit.value;
                    document.getElementById('contactPhone').textContent = contactPhone.value;
                    document.getElementById('contactPhone').href = `tel:${contactPhone.value.replace(/-/g, '')}`;
                });

                return {
                    toiletName,
                    cleanerName,
                    lastPunchTime,
                    openTime,
                    maintenanceUnit,
                    contactPhone,
                    punchButtonText,
                    currentTimeLocation,
                    handlePunch,
                    hasMoreSuggestions
                };
            }
        }).mount('#app');

        // Adjust app-wrapper height based on viewport for better 9:18 feel
        function adjustAppWrapperSize() {
            const wrapper = document.getElementById('app-wrapper');
            const viewportHeight = window.innerHeight;
            const viewportWidth = window.innerWidth;

            // Calculate max width based on 9:18 aspect ratio from viewport height
            let idealWidth = viewportHeight * (9 / 18);
            // Calculate max height based on 9:18 aspect ratio from viewport width
            let idealHeight = viewportWidth * (18 / 9);

            if (idealWidth > viewportWidth) {
                // If ideal width is too large, constrain by viewport width and calculate height
                wrapper.style.width = `${viewportWidth}px`;
                wrapper.style.height = `${Math.min(idealHeight, viewportHeight)}px`;
                 wrapper.style.maxWidth = `${viewportWidth}px`;
            } else {
                // Constrain by viewport height and calculate width
                wrapper.style.height = `${viewportHeight}px`;
                wrapper.style.width = `${Math.min(idealWidth, viewportWidth)}px`;
                wrapper.style.maxHeight = `${viewportHeight}px`;
            }
             // Fallback for very small screens or extreme ratios, ensuring it doesn't get too small
            if (parseFloat(wrapper.style.width) < 300) {
                wrapper.style.width = '300px';
                wrapper.style.height = '600px'; // Maintain ratio
            }
            if (parseFloat(wrapper.style.height) < 500 && parseFloat(wrapper.style.width) > 250) {
                 wrapper.style.height = `${parseFloat(wrapper.style.width) * 2}px`;
            }

             // Center the app wrapper if it's smaller than the window
            wrapper.style.position = 'absolute';
            wrapper.style.left = '50%';
            wrapper.style.top = '50%';
            wrapper.style.transform = 'translate(-50%, -50%)';

        }

        window.addEventListener('resize', adjustAppWrapperSize);
        adjustAppWrapperSize(); // Initial call

    </script>
</body>
</html>
